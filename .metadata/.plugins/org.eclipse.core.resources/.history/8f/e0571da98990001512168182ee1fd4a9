package uk.co.luciditysoftware.campervibe.tests.domain.entities.booking;

import static org.junit.Assert.*;

import java.text.*;
import java.util.*;
import org.junit.*;
import uk.co.luciditysoftware.campervibe.domain.requests.booking.*;
import uk.co.luciditysoftware.campervibe.domain.entities.*;

public class ValidateMakeTests 
{
	@Test
	public void ValidRequestPasses()
    {
		/*
        var customer = new Customer()
        {
            Id = Guid.NewGuid(),
            FamilyName = "Blue"
        };
		*/
		
		Vehicle vehicle = new Vehicle();
		/*{{ 
            //Id = Guid.NewGuid()
        }};*/

        List<Booking> bookings = new ArrayListList<Booking>();
        SimpleDateFormat dateFormat = new SimpleDateFormat("dd-M-yyyy hh:mm:ss");
        
        bookings.add(new Booking() 
        {{
            setStartDate = new DateTime(2050, 9, 1),
            EndDate = new DateTime(2050, 9, 3),
            Vehicle = vehicle
        }});

        vehicle.setBookings(bookings);
		MakeRequest request = new MakeRequest();
        //request.Customer = customer;
        requestsetStartDate = new DateTime(2050, 10, 1);
        request.EndDate = new DateTime(2050, 10, 3);
        request.Vehicle = vehicle;

        var validationMessages = Booking.ValidateMake(request);

        Assert.AreEqual(0, validationMessages.Count);*/
    }

    [TestMethod]
    public void InvalidRequestFails()
    {
        var request = new MakeBookingRequest();

        var customer = new Customer()
        {
            Id = Guid.NewGuid(),
            FamilyName = "Blue"
        };

        var vehicle = new Vehicle()
        {
            Id = Guid.NewGuid()
        };

        vehicle.Bookings = new List<Booking>()
        {
            new Booking() 
            {
                StartDate = new DateTime(2050, 9, 30),
                EndDate = new DateTime(2050, 10, 2),
                Vehicle = vehicle
            }
        };

        request.Customer = customer;
        request.StartDate = new DateTime(2050, 10, 1);
        request.EndDate = new DateTime(2050, 10, 3);
        request.Vehicle = vehicle;

        var validationMessages = Booking.ValidateMake(request);

        Assert.AreEqual(1, validationMessages.Count);
        Assert.IsTrue(validationMessages.Any(x => x.Text.Equals("Booking conflicts with existing bookings.")));
    }
}
